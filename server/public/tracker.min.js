var Tracker=function(){"use strict";var n={events:["click"],uploadType:"immedite",mode:"sample"},m="TRACKER/DATA";function g(e){if(!e)return"";if(e.id)return"#"+e.id;var t=e.tagName.toLowerCase();return e.className?t+"."+e.className.split(/\s+/).join("."):t}function e(e){var t=this;this._eventHandler=function(e){t._handleEvent(e)},this._config=Object.assign({},n,e)}return e.prototype.regist=function(){for(var e=this,t=this._config,n=t.events,o=t.uploadType,r=0;r<n.length;r+=1){var a=n[r];document.body.addEventListener(a,this._eventHandler)}return"unload"!==o&&window.addEventListener("beforeunload",function(){e._uploadUnload()}),this},e.prototype.removeWith=function(e){document.body.removeEventListener(e,this._eventHandler)},e.prototype._handleEvent=function(e){var t,n,o,r,a,i,l,d=this._config.uploadType,c=e.target,s=function(e){for(var t=[];e;){var n=g(e);if(!n)break;var o=e.parentElement,r=o.childElementCount,a=o.children;if(1<r)for(var i=0;i<r;i+=1)if(a[i]===e){n=n+":nth-child("+(i+1)+")";break}if(t.unshift(n),n.includes("body")||document.querySelector(t.join(">"))===e)break;e=e.parentElement}return t.join(">")}(c),u=(n=(t=e).target.getBoundingClientRect(),o=n.left,r=n.top,a=document.documentElement,i=a.scrollLeft,l=a.scrollTop,[t.pageX-i-o,t.pageY-l-r]),p={nodeName:c.nodeName.toLowerCase(),type:e.type,path:encodeURIComponent(s),position:u};if("immedite"===d)this._upload(p);else{var f=JSON.parse(localStorage.getItem(m)),v=[p];f&&v.push.apply(v,f),localStorage.setItem(m,JSON.stringify(v))}},e.prototype._upload=function(e){var t=this._config.uploadUrl,n=new Image(0,0);n.src=t+"?"+function(e){for(var t=[],n=0,o=Object.keys(e);n<o.length;n++){var r=o[n];t.push(r+"="+e[r])}return t.join("&")}(e),n.onload=function(){n=null}},e.prototype._uploadUnload=function(){var e=this._config.uploadUrl,t=JSON.parse(localStorage.getItem(m));localStorage.removeItem(m),t&&(alert("uploading..."),navigator.sendBeacon(e,t))},e}();
